# T√™n c·ªßa workflow, s·∫Ω hi·ªÉn th·ªã tr√™n tab Actions
name: 'VietnamWorks Daily Scraper'

on:
  # Cho ph√©p b·∫°n ch·∫°y th·ªß c√¥ng t·ª´ tab Actions
  workflow_dispatch:
  
  # L·ªãch ch·∫°y t·ª± ƒë·ªông
  schedule:
    # Ch·∫°y 4 l·∫ßn m·ªói ng√†y, l·ªách 1 gi·ªù so v·ªõi TopCV ƒë·ªÉ tr√°nh ch·∫°y c√πng l√∫c
    # T∆∞∆°ng ·ª©ng: 8h s√°ng, 1h tr∆∞a, 6h chi·ªÅu, 11h t·ªëi (gi·ªù Vi·ªát Nam)
    - cron: '0 1,6,11,18 * * *'

jobs:
  scrape-vietnamworks:
    runs-on: ubuntu-latest
    permissions:
      # C·∫•p quy·ªÅn ƒë·ªÉ workflow c√≥ th·ªÉ commit file CSV v√†o repository
      contents: write
   
    steps:
      - name: 'Checkout repository'
        uses: actions/checkout@v4
          
      - name: 'Set up Node.js'
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          
      - name: 'Install project dependencies'
        run: npm install
      
      # Kh√¥ng c·∫ßn b∆∞·ªõc c√†i ƒë·∫∑t Chrome v√¨ script n√†y d√πng Axios
      
      - name: 'Run VietnamWorks Scraper'
        # Script n√†y kh√¥ng c·∫ßn secrets, n√≥ s·∫Ω ch·∫°y tr·ª±c ti·∫øp
        run: node vietnamworks-scraper.js
      
      - name: 'Commit results to repository'
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "üìä D·ªØ li·ªáu VietnamWorks: Th√™m file d·ªØ li·ªáu m·ªõi"
          # Ch·ªâ commit c√°c file CSV c·ªßa VietnamWorks
          file_pattern: "data/vietnamworks_*.csv"
